import{_ as _e,a as he,b as be}from"./headSticker-XsKf4qe2.js";import{_ as ge}from"./Index.vue_vue_type_script_setup_true_lang-FMNXOtW6.js";import{d as H,al as ye,a3 as J,a6 as Z,r as R,G as K,v as z,o as l,i as F,w as U,a as e,t as r,h as s,c as n,n as b,V as f,ai as w,L as _,M as x,b as h,W as V,l as N,ah as we,am as G,ab as L,s as xe,q as ke,m as M}from"./index-7nT60dns.js";import{_ as Pe,a as De,Z as Se}from"./AddressSelect.vue_vue_type_script_setup_true_lang-LhJqtQFn.js";import{z as p,t as q}from"./vee-validate-zod.esm-PoO9-eoE.js";import"./BaseButton.vue_vue_type_style_index_0_lang-tMje1htf.js";const $e={class:"col-12 col-lg p-0 h-100"},Be={class:"card rounded-3 border-0"},ze={class:"card-body p-4 p-lg-6"},Ue={class:"mb-4 mb-lg-6 text-neutral"},Fe={class:"d-flex flex-column gap-2 mb-3 mb-lg-4"},Ce=e("span",null,"電子信箱",-1),Ie={class:"text-neutral fw-bold"},Ae={key:0,class:"d-flex align-items-center justify-content-between"},Te=e("div",{class:"d-flex flex-column gap-2"},[e("span",null,"密碼"),e("span",{class:"text-neutral",style:{"font-size":"12px"}}," ● ● ● ● ● ● ● ● ● ● ")],-1),Ee={key:1,class:"d-flex flex-column"},je={class:"d-flex flex-column gap-3 gap-lg-4"},Ve={class:"d-flex flex-column gap-2"},Re={key:0,class:"invalid-feedback d-block"},Ne={class:"d-flex flex-column gap-2"},Oe={key:0,class:"invalid-feedback d-block"},We={class:"d-flex flex-column gap-2"},Ze={key:0,class:"invalid-feedback d-block"},Ge={class:"d-flex pt-4 pt-lg-6"},Le=["disabled"],Me={class:"col-12 col-lg p-0 h-100"},qe={class:"card rounded-3 border-0"},He={class:"card-body p-4 p-lg-6"},Je=e("h5",{class:"mb-4 mb-lg-6 text-neutral"},"基本資料",-1),Ke={class:"d-flex flex-column gap-3 gap-lg-4"},Qe={class:"d-flex flex-column gap-2"},Xe={key:0,class:"text-neutral fw-bold"},Ye={key:1},es={key:0,class:"invalid-feedback d-block"},ss={class:"d-flex flex-column gap-2"},ts={key:0,class:"text-neutral fw-bold"},as={key:1},ls={key:0,class:"invalid-feedback d-block"},os={class:"d-flex flex-column gap-2"},ds={key:0,class:"text-neutral fw-bold"},ns={class:"d-flex flex-column gap-3"},is={class:"d-flex flex-column gap-3"},rs={key:0,class:"invalid-feedback d-block"},cs={class:"d-flex pt-4 pt-lg-6"},us=["disabled"],ms=H({__name:"UserPasswordForm",props:{userInfoData:{type:Object,required:!0}},setup(O){const C=O,{userInfoData:o}=ye(C),g=J(),c=p.object({name:p.string().min(1,"請輸入姓名").regex(new RegExp(/^[a-zA-Z\u4e00-\u9fa5\s]+$/),"請輸入您的中英文姓名，可包含空白，但不能包含特殊字元").default(o.value.name||""),phone:p.string().min(1,"請輸入手機號碼").regex(new RegExp(/^\d+$/),"請輸入數字").startsWith("09",{message:"請輸入正確的手機號碼格式"}).length(10,{message:"請輸入正確的手機號碼格式"}).default(o.value.phone||""),zipcode:p.number().default(o.value.address.zipcode||800),addressDetail:p.string().min(1,"請輸入詳細地址").default(o.value.address.detail||""),birthday:p.string().min(1,"請選擇生日").default(o.value.birthday||"1990/8/15")}),I=p.object({oldPassword:p.string().min(1,"請輸入舊密碼").min(8,"密碼需至少 8 碼以上").regex(new RegExp(/^(?=.*[a-zA-Z])(?=.*\d).+$/),"密碼需包含數字與英文字母").default(""),newPassword:p.string().min(1,"請輸入新密碼").min(8,"密碼需至少 8 碼以上").regex(new RegExp(/^(?=.*[a-zA-Z])(?=.*\d).+$/),"密碼需包含數字與英文字母").default(""),confirm:p.string().min(1,"請再輸入一次密碼").default("")}).refine(t=>t.newPassword===t.confirm,{message:"與新密碼不符",path:["confirm"]}),{resetForm:y,values:Q,errors:u,setValues:X,defineField:k}=Z({validationSchema:q(c)}),{resetForm:Y,values:ee,errors:m,setValues:se,defineField:A}=Z({validationSchema:q(I)}),i=R(!1),v=R(!1),[P,te]=k("name"),[D,ae]=k("phone"),[T,le]=k("birthday"),[E,oe]=k("zipcode"),[S,de]=k("addressDetail"),[$,ne]=A("oldPassword"),[B,ie]=A("newPassword"),[j,re]=A("confirm");function W(){y(),Y(),v.value=!1,i.value=!1}K(o,t=>{t&&(X({name:t.name,phone:t.phone,birthday:t.birthday,zipcode:t.address.zipcode,addressDetail:t.address.detail}),se({oldPassword:"",newPassword:"",confirm:""}))},{immediate:!0,deep:!0});const ce=z(()=>Object.values(ee).every(t=>t!=="")&&Object.keys(m.value).length==0),ue=z(()=>Object.values(Q).every(t=>t!=="")&&Object.keys(u.value).length==0),me=z(()=>new Date(o.value.birthday).toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric"})),pe=z(()=>{const t=Se.find(a=>a.zipcode===o.value.address.zipcode);return`${t==null?void 0:t.county}${t==null?void 0:t.city}${o.value.address.detail}`});function fe(){let t={userId:o.value.userId,oldPassword:String($.value),newPassword:String(B.value)};G(t).then(()=>{L.fire({icon:"success",title:"修改帳號資料成功",showCancelButton:!0,showConfirmButton:!1,cancelButtonText:"確定"}).then(()=>{g.fetchUser(),W()})})}function ve(){let t={userId:o.value.userId,name:String(P.value),phone:String(D.value),birthday:String(T.value),address:{zipcode:Number(E.value),detail:String(S.value)}};G(t).then(()=>{L.fire({icon:"success",title:"修改基本資料成功",showCancelButton:!0,showConfirmButton:!1,cancelButtonText:"確定"}).then(()=>{g.fetchUser(),W()})})}return(t,a)=>(l(),F(s(we),{class:"row gap-4 gap-lg-6 d-flex flex-column flex-lg-row w-100 m-auto"},{default:U(()=>[e("div",$e,[e("div",Be,[e("div",ze,[e("h5",Ue,r(v.value?"修改帳號資料":"修改密碼"),1),e("div",Fe,[Ce,e("span",Ie,r(s(o).email),1)]),v.value?(l(),n("div",Ee,[e("div",je,[e("div",Ve,[e("label",{for:"oldPassword",class:b({"edit-label":v.value})}," 舊密碼 ",2),e("div",null,[f(e("input",_({id:"oldPassword",class:["form-control p-3",{"is-invalid":s(m).oldPassword}],type:"password",autocomplete:"on",placeholder:"請輸入舊密碼","onUpdate:modelValue":a[1]||(a[1]=d=>x($)?$.value=d:null)},s(ne)),null,16),[[w,s($)]]),s(m).oldPassword?(l(),n("div",Re,r(s(m).oldPassword),1)):h("",!0)])]),e("div",Ne,[e("label",{for:"newPassword",class:b({"edit-label":v.value})}," 新密碼 ",2),e("div",null,[f(e("input",_({id:"newPassword",class:["form-control p-3",{"is-invalid":s(m).newPassword}],type:"password",autocomplete:"on",placeholder:"請輸入舊密碼","onUpdate:modelValue":a[2]||(a[2]=d=>x(B)?B.value=d:null)},s(ie)),null,16),[[w,s(B)]]),s(m).newPassword?(l(),n("div",Oe,r(s(m).newPassword),1)):h("",!0)])]),e("div",We,[e("label",{for:"confirm",class:b({"edit-label":v.value})}," 確認新密碼 ",2),e("div",null,[f(e("input",_({id:"confirm",class:["form-control p-3",{"is-invalid":s(m).confirm}],type:"password",autocomplete:"on",placeholder:"請輸入舊密碼","onUpdate:modelValue":a[3]||(a[3]=d=>x(j)?j.value=d:null)},s(re)),null,16),[[w,s(j)]]),s(m).confirm?(l(),n("div",Ze,r(s(m).confirm),1)):h("",!0)])])]),e("div",Ge,[e("button",{type:"button",class:"baseButton isStylePrimary",disabled:!ce.value,onClick:fe}," 儲存設定 ",8,Le)])])):(l(),n("div",Ae,[Te,e("div",{class:"baseButton isStyleText",onClick:a[0]||(a[0]=d=>v.value=!v.value)}," 重設 ")]))])])]),e("div",Me,[e("div",qe,[e("div",He,[Je,e("div",Ke,[e("div",Qe,[e("label",{for:"name",class:b({"edit-label":i.value})}," 姓名 ",2),i.value?(l(),n("div",Ye,[f(e("input",_({id:"name",class:["form-control p-3",{"is-invalid":s(u).name}],type:"text",placeholder:"請輸入姓名","onUpdate:modelValue":a[4]||(a[4]=d=>x(P)?P.value=d:null)},s(te)),null,16),[[w,s(P),void 0,{trim:!0}]]),s(u).name?(l(),n("div",es,r(s(u).name),1)):h("",!0)])):(l(),n("div",Xe,r(s(o).name),1))]),e("div",ss,[e("label",{for:"phone",class:b({"edit-label":i.value})}," 手機號碼 ",2),i.value?(l(),n("div",as,[f(e("input",_({id:"phone",class:["form-control p-3",{"is-invalid":s(u).phone}],type:"text",placeholder:"請輸入手機號碼","onUpdate:modelValue":a[5]||(a[5]=d=>x(D)?D.value=d:null)},s(ae)),null,16),[[w,s(D),void 0,{trim:!0}]]),s(u).phone?(l(),n("div",ls,r(s(u).phone),1)):h("",!0)])):(l(),n("div",ts,r(s(o).phone),1))]),e("div",os,[e("label",{for:"birthday",class:b({"edit-label":i.value})}," 生日 ",2),i.value?(l(),F(Pe,_({key:1,"model-value":s(T)},s(le),{"onUpdate:modelValue":a[6]||(a[6]=d=>T.value=d)}),null,16,["model-value"])):(l(),n("div",ds,r(me.value),1))]),e("div",ns,[e("label",{for:"addressDetail",class:b({"edit-label":i.value})}," 地址 ",2),f(e("div",{class:"text-neutral fw-bold"},r(pe.value),513),[[V,!i.value]]),f(e("div",null,[f(e("div",is,[N(De,_({"model-value":s(E)},s(oe),{"onUpdate:modelValue":a[7]||(a[7]=d=>E.value=d)}),null,16,["model-value"]),f(e("input",_({id:"addressDetail",class:["form-control p-3",{"is-invalid":s(u).addressDetail}],type:"text",placeholder:"請輸入詳細地址","onUpdate:modelValue":a[8]||(a[8]=d=>x(S)?S.value=d:null)},s(de)),null,16),[[w,s(S)]])],512),[[V,i.value]]),s(u).addressDetail?(l(),n("div",rs,r(s(u).addressDetail),1)):h("",!0)],512),[[V,i.value]])])]),e("div",cs,[i.value?(l(),n("button",{key:1,type:"button",class:"baseButton isStylePrimary",disabled:!ue.value,onClick:ve}," 儲存設定 ",8,us)):(l(),n("button",{key:0,class:"baseButton isStyleSecondary",onClick:a[9]||(a[9]=d=>i.value=!i.value)}," 編輯 "))])])])])]),_:1}))}}),ps={class:"bg-neutral-dark user"},fs={class:"banner"},vs=e("img",{class:"banner__bg w-100 d-none d-lg-block",src:_e,alt:"userBanner"},null,-1),_s=e("img",{class:"banner__bg w-100 d-block d-lg-none",src:he,alt:"userBanner"},null,-1),hs={class:"banner__container container"},bs={class:"banner__head d-flex flex-column flex-lg-row align-items-lg-center gap-3 gap-lg-4"},gs=e("img",{src:be,alt:"headSticker"},null,-1),ys={key:0,class:"text-white fw-bold m-0"},ws={class:"container-lg pb-6 pb-lg-11"},xs={class:"py-6 py-lg-10"},zs=H({__name:"Index",setup(O){const C=J(),{userInformation:o}=xe(C),g=R();return K(()=>o.value,c=>{if(c){const y=new Date(c.birthday).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"});g.value={userId:c._id,name:c.name,email:c.email,phone:c.phone,address:c.address,birthday:y}}},{immediate:!0,deep:!0}),(c,I)=>{const y=ke("router-link");return l(),F(ge,{"is-has-footer-decoration":""},{default:U(()=>[e("section",ps,[e("div",fs,[vs,_s,e("div",hs,[e("div",bs,[gs,s(o)?(l(),n("h1",ys," Hello，"+r(s(o).name),1)):h("",!0)])])]),e("div",ws,[e("nav",xs,[N(y,{to:"/user",class:"baseButton isStyleGhost px-4 py-3","active-class":"active"},{default:U(()=>[M(" 個人資料 ")]),_:1}),N(y,{to:"/user/orders",class:"baseButton isStyleGhost px-4 py-3","active-class":"active"},{default:U(()=>[M(" 我的訂單 ")]),_:1})]),g.value?(l(),F(ms,{key:0,userInfoData:g.value},null,8,["userInfoData"])):h("",!0)])])]),_:1})}}});export{zs as default};
